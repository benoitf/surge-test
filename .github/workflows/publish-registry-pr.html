name: Release
on:
  workflow_run:
    workflows: [ "Image Build PR check" ]
    types:
      - completed

jobs:
  publish:
    name: publish
    runs-on: ubuntu-20.04
    steps:
      - name: download dist artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: ${{ github.event.workflow_run.workflow_id }}
          name: plugin-registry-content-alpine
          path: content
      - name: generate-tree
      run: |
        sudo apt-get install tree
        ls -la content/
        for directory in `find content/ -type d`
          do
            (cd $directory && tree -H '.' -L 1 --noreport --charset utf-8 | sed '/<p class="VERSION">/,/<\/p>/d' > index.html)
         done
         ls -la content/
         cat content/index.html
